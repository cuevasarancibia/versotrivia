<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Juego: ¿Qué Tan Perverso es el Cuento?</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/tone/14.8.49/Tone.js"></script>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #1f2937; /* bg-gray-800 */
            color: #f3f4f6; /* text-gray-200 */
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            padding: 1rem;
            overflow-x: hidden;
        }
        .game-container {
            background-color: #374151; /* bg-gray-700 */
            padding: 2rem;
            border-radius: 1rem;
            box-shadow: 0 10px 25px rgba(0,0,0,0.3);
            width: 100%;
            max-width: 600px;
            text-align: center;
        }
        .btn {
            display: block;
            width: 100%;
            padding: 0.75rem 1rem;
            margin-top: 0.75rem;
            border-radius: 0.5rem;
            font-weight: 600;
            transition: background-color 0.3s ease, transform 0.1s ease;
            cursor: pointer;
            border: none;
            font-size: 1rem;
        }
        .btn-primary {
            background-color: #ef4444; /* bg-red-600 */
            color: white;
        }
        .btn-primary:hover {
            background-color: #dc2626; /* bg-red-700 */
        }
        .btn-primary:active {
            transform: scale(0.98);
        }
        .btn-option {
            background-color: #4b5563; /* bg-gray-600 */
            color: white;
        }
        .btn-option:hover {
            background-color: #6b7280; /* bg-gray-500 */
        }
        .btn-option.correct {
            background-color: #10b981; /* bg-emerald-500 */
        }
        .btn-option.incorrect {
            background-color: #9ca3af; /* bg-gray-400 */
            opacity: 0.7;
        }
        .btn-option:disabled {
            cursor: not-allowed;
        }
        .feedback-text {
            margin-top: 1rem;
            font-size: 1.1rem;
            font-weight: bold;
            min-height: 1.5em;
        }
        .text-correct {
            color: #34d399; /* text-emerald-400 */
        }
        .text-incorrect {
            color: #f87171; /* text-red-400 */
        }
        h1, h2 {
            color: #eab308; /* text-yellow-500 */
        }
        #question-text {
            min-height: 4.5em; /* Para evitar saltos de layout con preguntas largas */
            margin-bottom: 1.5rem;
            font-size: 1.25rem;
            line-height: 1.6;
        }
        .progress-bar-container {
            width: 100%;
            background-color: #4b5563; /* bg-gray-600 */
            border-radius: 0.25rem;
            margin-bottom: 1.5rem;
            height: 10px;
        }
        .progress-bar {
            height: 10px;
            width: 0%;
            background-color: #ef4444; /* bg-red-600 */
            border-radius: 0.25rem;
            transition: width 0.3s ease-in-out;
        }
    </style>
</head>
<body>
    <div class="game-container">
        <div id="start-screen">
            <h1 class="text-3xl font-bold mb-4">¿Qué Tan Perverso es el Cuento?</h1>
            <p class="mb-6 text-lg">Descubre cuánto sabes sobre los giros inesperados en los cuentos de Roald Dahl. ¡Ahora con 50 preguntas, 15 por juego y efectos de sonido!</p>
            <button id="start-button" class="btn btn-primary">¡Comenzar Juego!</button>
        </div>

        <div id="game-screen" class="hidden">
            <div class="progress-bar-container">
                <div id="progress-bar" class="progress-bar"></div>
            </div>
            <h2 id="story-title" class="text-2xl font-semibold mb-2"></h2>
            <p id="question-text" class="text-xl mb-6"></p>
            <div id="options-container" class="space-y-3">
            </div>
            <p id="feedback" class="feedback-text"></p>
            <button id="next-button" class="btn btn-primary mt-6 hidden">Siguiente Pregunta</button>
        </div>

        <div id="end-screen" class="hidden">
            <h1 class="text-3xl font-bold mb-4">¡Juego Terminado!</h1>
            <p id="score-text" class="text-2xl mb-6"></p>
            <button id="play-again-button" class="btn btn-primary">Jugar de Nuevo</button>
        </div>
    </div>

    <script>
        const startScreen = document.getElementById('start-screen');
        const gameScreen = document.getElementById('game-screen');
        const endScreen = document.getElementById('end-screen');

        const startButton = document.getElementById('start-button');
        const storyTitleElement = document.getElementById('story-title');
        const questionTextElement = document.getElementById('question-text');
        const optionsContainer = document.getElementById('options-container');
        const feedbackElement = document.getElementById('feedback');
        const nextButton = document.getElementById('next-button');
        const scoreTextElement = document.getElementById('score-text');
        const playAgainButton = document.getElementById('play-again-button');
        const progressBar = document.getElementById('progress-bar');

        const NUM_QUESTIONS_PER_GAME = 15;

        // Sound Synthesizers (Tone.js)
        let correctSound, incorrectSound;

        // Initialize sounds after user interaction (e.g., clicking start button)
        function initializeSounds() {
            if (typeof Tone !== 'undefined') {
                correctSound = new Tone.Synth({
                    oscillator: { type: 'triangle' },
                    envelope: { attack: 0.005, decay: 0.1, sustain: 0.3, release: 0.3 }
                }).toDestination();
                
                incorrectSound = new Tone.Synth({
                    oscillator: { type: 'square' },
                    envelope: { attack: 0.01, decay: 0.2, sustain: 0.1, release: 0.2 }
                }).toDestination();
            } else {
                console.warn("Tone.js no está cargado. Los sonidos no funcionarán.");
            }
        }
        
        function playCorrectSound() {
            if (correctSound && Tone.context.state === 'running') {
                correctSound.triggerAttackRelease('C5', '8n', Tone.now());
                correctSound.triggerAttackRelease('G5', '8n', Tone.now() + 0.15);
            }
        }

        function playIncorrectSound() {
            if (incorrectSound && Tone.context.state === 'running') {
                incorrectSound.triggerAttackRelease('A2', '4n', Tone.now());
            }
        }


        const allQuestions = [
            // La Cenicienta
            { story: "La Cenicienta", question: "¿Qué acción 'perversa' realiza el Príncipe que hace que Cenicienta no quiera casarse con él?", options: ["Le regala un zapato usado", "Ordena cortar cabezas", "Baila muy mal", "Le dice que su vestido es feo"], correctAnswerIndex: 1 },
            { story: "La Cenicienta", question: "¿Qué hace una de las Hermanastras con el zapato de cristal de Cenicienta?", options: ["Lo esconde bajo su cama", "Lo rompe en mil pedazos", "Lo tira al retrete y lo cambia por el suyo", "Se lo prueba y le queda perfecto"], correctAnswerIndex: 2 },
            { story: "La Cenicienta", question: "¿Qué le pide Cenicienta al Hada Madrina al final, en lugar de un príncipe?", options: ["Un castillo más grande", "Un compañero honrado y buena gente", "Venganza contra sus hermanastras", "Riquezas infinitas"], correctAnswerIndex: 1 },
            { story: "La Cenicienta", question: "¿Con quién se casa Cenicienta al final de la versión de Dahl?", options: ["Con un panadero rico", "Con un duque extranjero", "Con un tipo que hacía mermelada", "Permanece soltera y feliz"], correctAnswerIndex: 2 },
            { story: "La Cenicienta", question: "¿Cómo describe el autor la versión tradicional de Cenicienta al inicio del cuento?", options: ["Emocionante y llena de aventuras", "Realista y conmovedora", "Rosada, tonta, cursi, azucarada", "Oscura y misteriosa"], correctAnswerIndex: 2 },
            { story: "La Cenicienta", question: "¿Qué amenaza Cenicienta con arrancarles a sus hermanastras mientras está encerrada?", options: ["Los ojos", "El moño", "Los vestidos de fiesta", "Las joyas"], correctAnswerIndex: 1 },
            { story: "La Cenicienta", question: "¿Qué pierde Cenicienta además de su zapato al huir del baile?", options: ["Su varita mágica", "Un guante de seda", "Parte de su vestido, escapando medio en camisa", "La invitación real"], correctAnswerIndex: 2 },
            { story: "La Cenicienta", question: "¿Qué piensa Cenicienta sobre el Príncipe cuando lo ve cortando cabezas?", options: ["Que es un líder fuerte y decidido", "Que es justo y necesario", "Que con él se juega la cabeza, ¡está loco!", "Que necesita un consejero urgentemente"], correctAnswerIndex: 2 },

            // Juan y la Habichuela Mágica
            { story: "Juan y la Habichuela Mágica", question: "¿Qué lección 'perversa' aprende Juan después de que el gigante se come a su madre?", options: ["Las habichuelas no son nutritivas", "Los gigantes son vegetarianos", "Bañarse es bueno para no ser comido", "Nunca confíes en un vendedor de habichuelas"], correctAnswerIndex: 2 },
            { story: "Juan y la Habichuela Mágica", question: "¿Qué le da Juan a su madre a cambio de la vaca Juana?", options: ["Cinco monedas de oro", "Una gallina que pone huevos de oro", "Una habichuela", "Un saco de semillas comunes"], correctAnswerIndex: 2 },
            { story: "Juan y la Habichuela Mágica", question: "¿Qué hace la madre de Juan con la habichuela al principio?", options: ["La cocina para la cena", "La planta con cuidado en una maceta", "La tira al huerto con enfado", "La guarda como un tesoro"], correctAnswerIndex: 2 },
            { story: "Juan y la Habichuela Mágica", question: "¿De qué material son las hojas de la planta mágica?", options: ["De plata brillante", "De esmeraldas relucientes", "De oro puro", "De seda fina"], correctAnswerIndex: 2 },
            { story: "Juan y la Habichuela Mágica", question: "¿Qué dice el gigante la primera vez que Juan sube?", options: ["'¡Huelo la sangre de un inglés!'", "'¡Huelo a niño asado!'", "'¡ESTOY OLIENDO A CARNE HUMANA!'", "'¿Quién anda en mi jardín?'"], correctAnswerIndex: 2 },
            { story: "Juan y la Habichuela Mágica", question: "Según la madre de Juan, ¿por qué lo olió el gigante la primera vez?", options: ["Porque Juan usaba un perfume muy fuerte", "Porque el gigante tenía un perro rastreador", "Porque Juan no se ducha más que en el verano", "Porque Juan había pisado excremento de vaca"], correctAnswerIndex: 2 },
            { story: "Juan y la Habichuela Mágica", question: "¿Qué comentario hace el gigante después de comerse a la madre de Juan?", options: ["'¡Deliciosa, pero un poco salada!'", "'¡Necesitaba más cocción!'", "'¡ESTABA DURA Y LE SOBRABAN HUESOS, PERO LOS MUSLITOS SUPIERON BIEN!'", "'¡La mejor comida en años!'"], correctAnswerIndex: 2 },
            { story: "Juan y la Habichuela Mágica", question: "¿Qué decide hacer Juan al final del cuento para seguir recogiendo oro?", options: ["Entrenar para ser más sigiloso", "Hacerse amigo del gigante", "Darse un baño al mes en el futuro", "Buscar otra planta mágica"], correctAnswerIndex: 2 },
            { story: "Juan y la Habichuela Mágica", question: "¿Con qué atiza la madre de Juan a su hijo cuando trae solo una habichuela?", options: ["Con una escoba", "Con un cinturón de cuero", "Con la manguera de la aspiradora", "Con una sartén"], correctAnswerIndex: 2 },

            // Blancanieves y los Siete Enanos
            { story: "Blancanieves", question: "¿Cómo se vuelven millonarios Blancanieves y los siete enanitos de forma 'perversa'?", options: ["Vendiendo manzanas envenenadas al por mayor", "Robando el Espejo Mágico para ganar apuestas", "Pidiendo un rescate por Blancanieves a la Reina", "Creando una mina de diamantes falsa"], correctAnswerIndex: 1 },
            { story: "Blancanieves", question: "¿Qué objeto mágico posee la Reina Obdulia Carrasclás?", options: ["Una varita que concede deseos", "Un anillo de invisibilidad", "Un Espejo Mágico Parlante", "Una alfombra voladora"], correctAnswerIndex: 2 },
            { story: "Blancanieves", question: "¿Qué le ordena la Reina al Cazador que le traiga de Blancanieves?", options: ["Un mechón de su cabello y una uña", "Su vestido más hermoso", "Su corazón caliente y palpitante", "Una prueba de que ha abandonado el reino"], correctAnswerIndex: 2 },
            { story: "Blancanieves", question: "¿Qué le da el Cazador a la Reina en lugar del corazón de Blancanieves?", options: ["El corazón de un ciervo", "El corazón de un jabalí", "El corazón de un cordero y costillas", "Una manzana roja y brillante"], correctAnswerIndex: 2 },
            { story: "Blancanieves", question: "¿Qué trabajo consigue Blancanieves en casa de los siete hombrecillos?", options: ["Cocinera y jardinera", "Minera de diamantes", "Ama de llaves", "Contadora de sus ganancias"], correctAnswerIndex: 2 },
            { story: "Blancanieves", question: "¿Cuál era la profesión anterior de los siete hombrecillos?", options: ["Leñadores", "Herreros", "Jockeys de carreras", "Zapateros reales"], correctAnswerIndex: 2 },
            { story: "Blancanieves", question: "¿Cuál era el vicio de los siete hombrecillos?", options: ["Jugar a las cartas por dinero", "Beber cerveza en exceso", "Las apuestas en las carreras", "Coleccionar objetos brillantes"], correctAnswerIndex: 2 },
            { story: "Blancanieves", question: "¿Qué yegua les dice el Espejo Mágico que ganará la carrera decisiva?", options: ["Estrella Fugaz", "Centella Veloz", "Rififí", "Dama Fortuna"], correctAnswerIndex: 2 },
            { story: "Blancanieves", question: "¿Qué hacen los enanos con sus pertenencias para apostar todo a Rififí?", options: ["Venden sus camas y duermen en el suelo", "Subastan sus herramientas de minería", "Vendieron el Volkswagen, empeñaron relojes y colchones", "Piden un préstamo al Rey vecino"], correctAnswerIndex: 2 },
            
            // Rizos de Oro y los Tres Osos
            { story: "Rizos de Oro", question: "En la versión 'perversa', ¿cuál es el final que el narrador sugiere para Rizos de Oro por sus travesuras?", options: ["Que pida disculpas y limpie todo el desorden", "Que los osos se la coman", "Que se haga amiga del Osito Bebé y le compre una silla nueva", "Que la envíen a un internado muy estricto"], correctAnswerIndex: 1 },
            { story: "Rizos de Oro", question: "Según el narrador, ¿qué debería pasarle a Rizos de Oro por sus acciones?", options: ["Recibir una buena reprimenda", "Ser perdonada por los osos", "Estar entre rejas", "Trabajar para los osos durante un año"], correctAnswerIndex: 2 },
            { story: "Rizos de Oro", question: "¿Qué objeto valioso de la casa de los osos rompe Rizos de Oro?", options: ["Un jarrón de porcelana", "El reloj cucú de Papá Oso", "Una silla de niño isabelina", "El telescopio del Osito Bebé"], correctAnswerIndex: 2 },
            { story: "Rizos de Oro", question: "¿Qué hace Rizos de Oro en la cama del Osito Bebé que enfada tanto al narrador?", options: ["Salta sobre ella hasta romperla", "Derrama un tazón de miel", "Se limpia los zapatos asquerosos llenos de barro", "Dibuja en las sábanas con carboncillo"], correctAnswerIndex: 2 },
            { story: "Rizos de Oro", question: "¿Cuántos 'crímenes' enumera el narrador que comete Rizos de Oro?", options: ["Dos", "Tres", "Cuatro", "Cinco"], correctAnswerIndex: 2 },
            { story: "Rizos de Oro", question: "En el final alternativo del narrador, ¿qué le dice Papá Oso al Osito sobre su sopa?", options: ["'No te preocupes, haré más'", "'Rizos de Oro la pagará'", "'Está en la barriga de Rizos de Oro, cómela a ella'", "'Seguro se la comió un duende'"], correctAnswerIndex: 2 },
            { story: "Rizos de Oro", question: "¿Por qué salen los osos de casa al principio del cuento?", options: ["Para ir de compras al mercado", "Para visitar a sus parientes osos", "Porque la sopa estaba demasiado caliente", "Para buscar miel en el bosque"], correctAnswerIndex: 2 },

            // Caperucita Roja y el Lobo
            { story: "Caperucita Roja", question: "¿Qué objeto 'perverso' e inesperado usa Caperucita para acabar con el Lobo?", options: ["Un libro de cuentos muy pesado", "Una pistola escondida en su corsé", "Un silbato ultrasónico para lobos", "Su capa roja para asfixiarlo"], correctAnswerIndex: 1 },
            { story: "Caperucita Roja", question: "¿Por qué el Lobo sigue hambriento después de comerse a la Abuela?", options: ["Porque la Abuela era vegetariana", "Porque solo se comió la mitad", "Porque era flaca y huesuda", "Porque compartió con otros lobos"], correctAnswerIndex: 2 },
            { story: "Caperucita Roja", question: "¿Cómo se disfraza el Lobo para engañar a Caperucita?", options: ["Se pone solo el gorro de la Abuela", "Se envuelve en una manta", "Se pone la ropa de la Abuela: falda, zapatos, etc.", "Se pinta canas y arrugas"], correctAnswerIndex: 2 },
            { story: "Caperucita Roja", question: "¿Qué comentario de Caperucita sobre la apariencia del Lobo lo saca de sus casillas?", options: ["'Abuelita, ¡qué aliento tan feo tienes!'", "'Abuelita, ¡qué orejas tan peludas!'", "'¡Qué imponente abrigo de piel llevas este invierno!'", "'Abuelita, ¡has engordado mucho!'"], correctAnswerIndex: 2 },
            { story: "Caperucita Roja", question: "En lugar de hablar de sus dientes, ¿de qué le habla Caperucita al Lobo, rompiendo el guion tradicional?", options: ["Del clima en el bosque", "De las flores que recogió", "De su abrigo de piel", "De los pasteles que lleva en la cesta"], correctAnswerIndex: 2 },
            { story: "Caperucita Roja", question: "¿Dónde llevaba Caperucita escondida su pistola?", options: ["En su cesta de mimbre", "Debajo de su caperuza", "En el corsé", "En una bota alta"], correctAnswerIndex: 2 },
            { story: "Caperucita Roja", question: "Al final del cuento, ¿qué prenda de vestir hecha de piel de animal lleva Caperucita?", options: ["Un sombrero de piel de zorro", "Unos guantes de piel de conejo", "Una piel de lobo", "Un chaleco de piel de oso"], correctAnswerIndex: 2 },
            { story: "Caperucita Roja", question: "¿Qué piensa el Lobo que Caperucita va a decir justo antes de que ella mencione el abrigo?", options: ["'¡Qué boca tan grande tienes!'", "'¡Qué ojos tan rojos tienes!'", "Que iba a hablar de sus dientes", "'¡Qué garras tan afiladas tienes!'"], correctAnswerIndex: 2 },

            // Los Tres Cerditos
            { story: "Los Tres Cerditos", question: "Además de sus abrigos de lobo, ¿qué otro accesorio 'perverso' de origen animal luce Caperucita al final?", options: ["Un sombrero de plumas de gallina", "Unos zapatos de piel de serpiente", "Un bolso de piel de cerdo", "Un cinturón de piel de oso"], correctAnswerIndex: 2 },
            { story: "Los Tres Cerditos", question: "¿De qué material hace el primer cerdito su casa?", options: ["De barro y ramas", "De cartón piedra", "De paja", "De hojas secas"], correctAnswerIndex: 2 },
            { story: "Los Tres Cerditos", question: "¿De qué material hace el segundo cerdito su casa?", options: ["De tela y cuerdas", "De bambú ligero", "De ramaje/madera", "De bloques de hielo"], correctAnswerIndex: 2 },
            { story: "Los Tres Cerditos", question: "¿Qué amenaza usar el Lobo para destruir la casa de ladrillos del tercer cerdito?", options: ["Un ariete gigante", "Un ejército de termitas", "Pólvora/dinamita", "Un hechizo mágico"], correctAnswerIndex: 2 },
            { story: "Los Tres Cerditos", question: "¿A quién llama por teléfono el tercer cerdito para pedir ayuda contra el Lobo?", options: ["A la policía del bosque", "A su hermano mayor, el jabalí", "A Caperucita Roja", "Al cazador del cuento de Blancanieves"], correctAnswerIndex: 2 },
            { story: "Los Tres Cerditos", question: "¿Qué le dice Caperucita al cerdito cuando este le pide ayuda?", options: ["'Estoy ocupada, llama más tarde'", "'¡Claro, voy enseguida con mi hacha!'", "'Iré en cuanto me seque la cabeza, estaba por comprar trapos'", "'Los lobos no son tan malos, intenta razonar'"], correctAnswerIndex: 2 }
        ];

        let gameQuestions = [];
        let currentQuestionIndex = 0;
        let score = 0;
        let answerSelected = false;

        startButton.addEventListener('click', async () => {
            // Iniciar Tone.js context en una interacción del usuario
            if (typeof Tone !== 'undefined' && Tone.context.state !== 'running') {
                await Tone.start();
                console.log("AudioContext iniciado por el usuario.");
            }
            initializeSounds(); // Asegurarse de que los sintetizadores están listos
            startGame();
        });
        nextButton.addEventListener('click', nextQuestion);
        playAgainButton.addEventListener('click', startGame);

        function shuffleArray(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
        }

        function startGame() {
            shuffleArray(allQuestions);
            gameQuestions = allQuestions.slice(0, NUM_QUESTIONS_PER_GAME);
            
            currentQuestionIndex = 0;
            score = 0;
            startScreen.classList.add('hidden');
            endScreen.classList.add('hidden');
            gameScreen.classList.remove('hidden');
            nextButton.classList.add('hidden');
            updateProgressBar();
            loadQuestion();
        }

        function loadQuestion() {
            answerSelected = false;
            feedbackElement.textContent = '';
            feedbackElement.className = 'feedback-text';
            nextButton.classList.add('hidden');

            if (currentQuestionIndex < gameQuestions.length) {
                const currentQuestion = gameQuestions[currentQuestionIndex];
                storyTitleElement.textContent = currentQuestion.story;
                questionTextElement.textContent = currentQuestion.question;
                optionsContainer.innerHTML = '';

                currentQuestion.options.forEach((option, index) => {
                    const button = document.createElement('button');
                    button.textContent = option;
                    button.classList.add('btn', 'btn-option');
                    button.addEventListener('click', () => selectAnswer(index, button));
                    optionsContainer.appendChild(button);
                });
            } else {
                endGame();
            }
        }

        function selectAnswer(selectedIndex, selectedButton) {
            if (answerSelected) return;
            answerSelected = true;

            const currentQuestion = gameQuestions[currentQuestionIndex];
            const correct = selectedIndex === currentQuestion.correctAnswerIndex;

            Array.from(optionsContainer.children).forEach((button, index) => {
                button.disabled = true;
                if (index === currentQuestion.correctAnswerIndex) {
                    button.classList.add('correct');
                } else if (index === selectedIndex && !correct) {
                    button.classList.add('incorrect');
                } else {
                     button.classList.add('opacity-50');
                }
            });

            if (correct) {
                score++;
                feedbackElement.textContent = '¡Correcto!';
                feedbackElement.classList.add('text-correct');
                playCorrectSound();
            } else {
                feedbackElement.textContent = 'Incorrecto.';
                feedbackElement.classList.add('text-incorrect');
                playIncorrectSound();
            }
            nextButton.classList.remove('hidden');
        }

        function nextQuestion() {
            currentQuestionIndex++;
            updateProgressBar();
            if (currentQuestionIndex < gameQuestions.length) {
                loadQuestion();
            } else {
                endGame();
            }
        }
        
        function updateProgressBar() {
            const progressPercentage = (currentQuestionIndex / gameQuestions.length) * 100;
            progressBar.style.width = `${progressPercentage}%`;
        }

        function endGame() {
            gameScreen.classList.add('hidden');
            endScreen.classList.remove('hidden');
            scoreTextElement.textContent = `Tu puntuación: ${score} de ${gameQuestions.length}`;
            progressBar.style.width = `100%`; 
        }

    </script>
</body>
</html>
